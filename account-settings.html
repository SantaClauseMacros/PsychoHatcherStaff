
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#ED1F27">
    <title>Account Settings - Psycho Hatcher</title>
    <link href="style.css" rel="stylesheet" type="text/css" />
    <link href="icons.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body class="account-settings-page">
    <header>
        <div class="logo-container">
            <img id="logo-preview" src="PsychoHatcher.png" alt="Psycho Hatcher Logo">
        </div>
        <h1>Account Settings</h1>
        <div class="header-actions">
            <a href="index.html" class="btn btn-outline">
                <i class="fas fa-home"></i> Back to Staff Portal
            </a>
            <button id="logout-btn" class="btn btn-outline">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
        </div>
    </header>

    <main>
        <section class="section-card">
            <h2><i class="fas fa-user-cog"></i> Account Customization</h2>
            
            <div class="account-info-area">
                <div class="account-avatar-section">
                    <h3>Profile Picture</h3>
                    <div class="avatar-preview user-avatar large" id="avatar-preview">üë§</div>
                    <div class="avatar-options">
                        <div class="form-group">
                            <label>Choose Emoji:</label>
                            <div class="emoji-picker" id="emoji-picker">
                                <span data-emoji="üë§">üë§</span>
                                <span data-emoji="üòé">üòé</span>
                                <span data-emoji="üöÄ">üöÄ</span>
                                <span data-emoji="üîß">üîß</span>
                                <span data-emoji="üëë">üëë</span>
                                <span data-emoji="üéÆ">üéÆ</span>
                                <span data-emoji="üíª">üíª</span>
                                <span data-emoji="üõ†Ô∏è">üõ†Ô∏è</span>
                                <span data-emoji="ü§ñ">ü§ñ</span>
                                <span data-emoji="ü¶∏">ü¶∏</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Background Color:</label>
                            <input type="color" id="avatar-color" value="#ED1F27">
                        </div>
                    </div>
                </div>
                
                <div class="account-details-section">
                    <h3>Account Details <span id="admin-badge"></span></h3>
                    <div class="form-group">
                        <label for="display-name">Display Name:</label>
                        <input type="text" id="display-name" class="form-control" placeholder="Your display name">
                    </div>
                    <div class="form-group">
                        <label for="theme-select">Theme:</label>
                        <select id="theme-select" class="form-control">
                            <option value="red">Red Theme</option>
                            <option value="black">Black Theme</option>
                            <option value="pureWhite">White Theme</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="dark-mode-toggle">
                            Dark Mode
                        </label>
                    </div>
                </div>
                
                <div id="admin-section" class="admin-section" style="display: none;">
                    <h3><i class="fas fa-shield-alt"></i> Admin Controls</h3>
                    <p class="info-text">Special permissions granted based on your admin level.</p>

                    <div class="admin-tools">
                        <button id="view-all-users" class="btn btn-sm">
                            <i class="fas fa-users"></i> View All Users
                        </button>
                        <button id="manage-suggestions" class="btn btn-sm" style="display: none;">
                            <i class="fas fa-tasks"></i> Manage Suggestions
                        </button>
                        <button id="reset-all-data" class="btn btn-sm btn-danger" style="display: none;">
                            <i class="fas fa-exclamation-triangle"></i> Reset All Data
                        </button>
                    </div>
                </div>
            </div>
        </section>
        
        <section class="section-card">
            <h2><i class="fas fa-key"></i> Password Change Request</h2>
            
            <div class="password-section">
                <p class="info-text">Password change requests are reviewed by Santa for security purposes.</p>
                <div class="form-group">
                    <label for="current-password">Current Password:</label>
                    <input type="password" id="current-password" class="form-control" placeholder="Enter current password">
                </div>
                <div class="form-group">
                    <label for="new-password">New Password:</label>
                    <input type="password" id="new-password" class="form-control" placeholder="Enter new password">
                </div>
                <div class="form-group">
                    <label for="confirm-password">Confirm New Password:</label>
                    <input type="password" id="confirm-password" class="form-control" placeholder="Confirm new password">
                </div>
                <div class="form-group">
                    <label for="password-reason">Reason for Change:</label>
                    <textarea id="password-reason" class="form-control" placeholder="Please provide a reason for the password change"></textarea>
                </div>
                <button id="request-password-change" class="btn">Submit Password Change Request</button>
                <div id="password-change-status" class="status-message"></div>
            </div>
        </section>
    </main>

    <footer>
        <p>&copy; 2025 Psycho Hatcher Staff Portal. All rights reserved.</p>
        <div class="footer-logo">
            <img id="footer-logo" src="PsychoHatcher.png" alt="Psycho Hatcher">
        </div>
    </footer>

    <script src="script.js"></script>
    <script src="login.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Check if user is logged in
        if (sessionStorage.getItem('staffLoggedIn') !== 'true') {
            window.location.href = 'index.html';
            return;
        }
        
        // Load user preferences
        loadUserPreferences();
        
        // Add event listeners
        document.getElementById('request-password-change').addEventListener('click', handlePasswordChangeRequest);
        
        // Emoji picker functionality
        document.querySelectorAll('#emoji-picker span').forEach(emoji => {
            emoji.addEventListener('click', function() {
                const selectedEmoji = this.getAttribute('data-emoji');
                document.getElementById('avatar-preview').textContent = selectedEmoji;

                // Highlight selected emoji
                document.querySelectorAll('#emoji-picker span').forEach(e => e.classList.remove('selected'));
                this.classList.add('selected');
            });
        });

        // Avatar color change
        document.getElementById('avatar-color').addEventListener('input', function() {
            document.getElementById('avatar-preview').style.backgroundColor = this.value;
        });

        // Dark mode toggle
        document.getElementById('dark-mode-toggle').addEventListener('change', function() {
            if (this.checked) {
                document.body.classList.add('dark-mode');
            } else {
                document.body.classList.remove('dark-mode');
            }
        });

        // Theme selector
        document.getElementById('theme-select').addEventListener('change', function() {
            switchLogo(this.value);
        });
        
        // Save button
        const saveBtn = document.createElement('button');
        saveBtn.id = 'save-account-settings';
        saveBtn.className = 'btn';
        saveBtn.innerHTML = '<i class="fas fa-save"></i> Save Changes';
        saveBtn.style.marginTop = '20px';
        document.querySelector('.account-details-section').appendChild(saveBtn);
        
        saveBtn.addEventListener('click', saveUserPreferences);
        
        // Admin controls
        setupAdminControls();
    });
    
    function loadUserPreferences() {
        const username = sessionStorage.getItem('loggedInUser') || 'Anonymous';
        const userPrefs = getUserPreferences();
        
        // Set display name
        document.getElementById('display-name').value = userPrefs.displayName || username;
        
        // Set avatar
        document.getElementById('avatar-preview').textContent = userPrefs.avatarEmoji || 'üë§';
        document.getElementById('avatar-preview').style.backgroundColor = userPrefs.avatarColor || '#ED1F27';
        
        // Select the correct emoji
        const selectedEmoji = document.querySelector(`#emoji-picker span[data-emoji="${userPrefs.avatarEmoji || 'üë§'}"]`);
        if (selectedEmoji) {
            selectedEmoji.classList.add('selected');
        }
        
        // Set avatar color
        document.getElementById('avatar-color').value = userPrefs.avatarColor || '#ED1F27';
        
        // Set theme
        document.getElementById('theme-select').value = userPrefs.theme || 'red';
        
        // Set dark mode
        document.getElementById('dark-mode-toggle').checked = userPrefs.darkMode || false;
        if (userPrefs.darkMode) {
            document.body.classList.add('dark-mode');
        }
    }
    
    function getUserPreferences() {
        const username = sessionStorage.getItem('loggedInUser') || 'Anonymous';
        const defaultPrefs = {
            displayName: username,
            avatarEmoji: 'üë§',
            avatarColor: '#ED1F27',
            theme: 'red',
            darkMode: false,
            notificationsEnabled: true,
            joinDate: new Date().toISOString()
        };

        try {
            const savedPrefs = localStorage.getItem(`userPrefs_${username}`);
            return savedPrefs ? JSON.parse(savedPrefs) : defaultPrefs;
        } catch (e) {
            console.error('Error loading user preferences:', e);
            return defaultPrefs;
        }
    }
    
    function saveUserPreferences() {
        const username = sessionStorage.getItem('loggedInUser') || 'Anonymous';
        
        // Gather form data
        const newPrefs = {
            displayName: document.getElementById('display-name').value,
            avatarEmoji: document.getElementById('avatar-preview').textContent,
            avatarColor: document.getElementById('avatar-color').value,
            theme: document.getElementById('theme-select').value,
            darkMode: document.getElementById('dark-mode-toggle').checked,
            notificationsEnabled: true,
            joinDate: getUserPreferences().joinDate || new Date().toISOString(),
            adminLevel: isAdmin() ? getAdminLevel() : 0
        };

        // Save preferences
        localStorage.setItem(`userPrefs_${username}`, JSON.stringify(newPrefs));
        
        // Apply theme
        switchLogo(newPrefs.theme);
        
        showNotification('Account settings saved successfully!', 'success');
    }
    
    function handlePasswordChangeRequest() {
        const currentPassword = document.getElementById('current-password').value;
        const newPassword = document.getElementById('new-password').value;
        const confirmPassword = document.getElementById('confirm-password').value;
        const reason = document.getElementById('password-reason').value;
        const statusElement = document.getElementById('password-change-status');

        // Validate fields
        if (!currentPassword || !newPassword || !confirmPassword || !reason) {
            statusElement.textContent = 'Please fill in all password fields.';
            statusElement.className = 'status-message error';
            return;
        }

        if (newPassword !== confirmPassword) {
            statusElement.textContent = 'New passwords do not match.';
            statusElement.className = 'status-message error';
            return;
        }

        // Get password change requests from storage
        let passwordRequests = JSON.parse(localStorage.getItem('passwordChangeRequests') || '[]');

        // Add new request with more detailed information
        passwordRequests.push({
            username: sessionStorage.getItem('loggedInUser') || 'Anonymous',
            requestDate: new Date().toISOString(),
            reason: reason,
            status: 'pending',
            reviewedBy: null,
            reviewDate: null,
            newPasswordHash: 'hashed_' + newPassword, // In a real app, you would properly hash this
            currentPasswordHash: 'hashed_' + currentPassword
        });

        // Save requests
        localStorage.setItem('passwordChangeRequests', JSON.stringify(passwordRequests));

        // Update status
        statusElement.textContent = 'Password change request submitted for review by Santa.';
        statusElement.className = 'status-message success';

        // Clear fields
        document.getElementById('current-password').value = '';
        document.getElementById('new-password').value = '';
        document.getElementById('confirm-password').value = '';
        document.getElementById('password-reason').value = '';

        showNotification('Password change request submitted to Santa for review', 'success');
    }
    
    function isAdmin() {
        const ADMIN_ACCOUNTS = ['Santa', 'Dr_Mo_Psycho', 'WaterMelone', 'Waktool'];
        const currentUser = sessionStorage.getItem('loggedInUser') || 'Anonymous';
        return ADMIN_ACCOUNTS.includes(currentUser);
    }
    
    function getAdminLevel() {
        const ADMIN_PERMISSIONS = {
            'Santa': 3, // Super admin - all permissions
            'Dr_Mo_Psycho': 2, // Senior admin
            'WaterMelone': 2, // Senior admin
            'Waktool': 1 // Standard admin
        };
        const currentUser = sessionStorage.getItem('loggedInUser') || 'Anonymous';
        return ADMIN_PERMISSIONS[currentUser] || 0;
    }
    
    function setupAdminControls() {
        if (!isAdmin()) return;
        
        const adminSection = document.getElementById('admin-section');
        const adminBadge = document.getElementById('admin-badge');
        const adminLevel = getAdminLevel();
        
        // Show admin badge
        adminBadge.textContent = `Admin Level ${adminLevel}`;
        adminBadge.className = 'admin-badge';
        
        // Show admin section
        adminSection.style.display = 'block';
        
        // Show buttons based on admin level
        if (adminLevel >= 2) {
            document.getElementById('manage-suggestions').style.display = 'inline-flex';
        }
        
        if (adminLevel >= 3) {
            document.getElementById('reset-all-data').style.display = 'inline-flex';
        }
        
        // Add event listeners for admin buttons
        document.getElementById('view-all-users').addEventListener('click', showAllUsersPanel);
        
        if (adminLevel >= 2) {
            document.getElementById('manage-suggestions').addEventListener('click', showSuggestionsManagementPanel);
        }
        
        if (adminLevel >= 3) {
            document.getElementById('reset-all-data').addEventListener('click', function() {
                if (confirm('WARNING: This will reset ALL site data including accounts, suggestions, and settings. This action cannot be undone. Continue?')) {
                    resetAllSiteData();
                }
            });
        }
    }
    
    function showAllUsersPanel() {
        // Create a list of all users who have preferences stored
        const users = [];

        // Get all localStorage keys
        for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            // Check if it's a user preferences key
            if (key && key.startsWith('userPrefs_')) {
                const username = key.replace('userPrefs_', '');
                try {
                    const userPrefs = JSON.parse(localStorage.getItem(key));
                    users.push({
                        username: username,
                        displayName: userPrefs.displayName || username,
                        joinDate: userPrefs.joinDate || 'Unknown',
                        lastLogin: userPrefs.lastLogin || 'Never',
                        isAdmin: isUserAdmin(username)
                    });
                } catch (e) {
                    console.error('Error parsing user data:', e);
                }
            }
        }

        // Sort users by admin status and then by username
        users.sort((a, b) => {
            if (a.isAdmin && !b.isAdmin) return -1;
            if (!a.isAdmin && b.isAdmin) return 1;
            return a.username.localeCompare(b.username);
        });

        // Create users panel modal
        const overlay = document.createElement('div');
        overlay.className = 'admin-panel-overlay';

        const panel = document.createElement('div');
        panel.className = 'admin-panel-container';

        // Create header
        const header = document.createElement('div');
        header.className = 'admin-panel-header';
        header.innerHTML = `
            <h2><i class="fas fa-users"></i> User Management</h2>
            <span>${users.length} users registered</span>
        `;

        // Create user list
        const userList = document.createElement('div');
        userList.className = 'admin-user-list';

        if (users.length === 0) {
            userList.innerHTML = '<p class="no-data">No users found</p>';
        } else {
            // Create table for users
            const table = document.createElement('table');
            table.className = 'admin-users-table';

            // Table header
            const thead = document.createElement('thead');
            thead.innerHTML = `
                <tr>
                    <th>Username</th>
                    <th>Display Name</th>
                    <th>Join Date</th>
                    <th>Admin</th>
                    <th>Actions</th>
                </tr>
            `;

            // Table body
            const tbody = document.createElement('tbody');

            users.forEach(user => {
                const tr = document.createElement('tr');

                // Format join date
                const joinDate = user.joinDate !== 'Unknown' ? 
                    new Date(user.joinDate).toLocaleDateString() : 'Unknown';

                tr.innerHTML = `
                    <td>${user.username}</td>
                    <td>${user.displayName}</td>
                    <td>${joinDate}</td>
                    <td>${user.isAdmin ? '<span class="admin-badge">Yes</span>' : 'No'}</td>
                    <td class="actions">
                        <button class="btn-sm view-user" data-username="${user.username}">
                            <i class="fas fa-eye"></i>
                        </button>
                        ${getAdminLevel() >= 3 ? `
                        <button class="btn-sm remove-user" data-username="${user.username}">
                            <i class="fas fa-trash"></i>
                        </button>` : ''}
                    </td>
                `;

                tbody.appendChild(tr);
            });

            table.appendChild(thead);
            table.appendChild(tbody);
            userList.appendChild(table);
        }

        // Add close button
        const closeBtn = document.createElement('button');
        closeBtn.className = 'btn';
        closeBtn.textContent = 'Close';

        // Add all elements to the panel
        panel.appendChild(header);
        panel.appendChild(userList);
        panel.appendChild(closeBtn);
        overlay.appendChild(panel);

        // Add to body
        document.body.appendChild(overlay);

        // Add event listeners
        closeBtn.addEventListener('click', () => {
            document.body.removeChild(overlay);
        });

        // View user buttons
        document.querySelectorAll('.view-user').forEach(btn => {
            btn.addEventListener('click', function() {
                const username = this.getAttribute('data-username');
                viewUserDetails(username);
            });
        });

        // Remove user buttons (for super admins only)
        if (getAdminLevel() >= 3) {
            document.querySelectorAll('.remove-user').forEach(btn => {
                btn.addEventListener('click', function() {
                    const username = this.getAttribute('data-username');
                    if (username === sessionStorage.getItem('loggedInUser')) {
                        showNotification("You cannot remove your own account!", "error");
                        return;
                    }

                    if (confirm(`Are you sure you want to remove user "${username}"? This action cannot be undone.`)) {
                        // Remove user preferences
                        localStorage.removeItem(`userPrefs_${username}`);
                        showNotification(`User "${username}" has been removed.`, "success");

                        // Reload the panel
                        document.body.removeChild(overlay);
                        showAllUsersPanel();
                    }
                });
            });
        }
    }
    
    function isUserAdmin(username) {
        const ADMIN_ACCOUNTS = ['Santa', 'Dr_Mo_Psycho', 'WaterMelone', 'Waktool'];
        return ADMIN_ACCOUNTS.includes(username);
    }
    
    function viewUserDetails(username) {
        const userPrefsKey = `userPrefs_${username}`;
        const userPrefs = JSON.parse(localStorage.getItem(userPrefsKey) || '{}');

        if (!userPrefs) {
            showNotification("User preferences not found", "error");
            return;
        }

        // Create user details modal
        const overlay = document.createElement('div');
        overlay.className = 'user-details-overlay';

        const panel = document.createElement('div');
        panel.className = 'user-details-container';

        // Add user avatar
        const avatar = document.createElement('div');
        avatar.className = 'user-avatar large';
        avatar.style.backgroundColor = userPrefs.avatarColor || '#ED1F27';
        avatar.textContent = userPrefs.avatarEmoji || 'üë§';

        // Format dates
        const joinDate = userPrefs.joinDate ? 
            new Date(userPrefs.joinDate).toLocaleString() : 'Unknown';

        // Build details content
        const details = document.createElement('div');
        details.className = 'user-details-content';
        details.innerHTML = `
            <h2>${username}</h2>
            <div class="user-info-grid">
                <div class="info-row">
                    <span class="info-label">Display Name:</span>
                    <span class="info-value">${userPrefs.displayName || username}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Join Date:</span>
                    <span class="info-value">${joinDate}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Admin Status:</span>
                    <span class="info-value">${isUserAdmin(username) ? 
                        `Admin Level ${getUserAdminLevel(username)}` : 'Regular User'}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Theme:</span>
                    <span class="info-value">${userPrefs.theme || 'Default'}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Dark Mode:</span>
                    <span class="info-value">${userPrefs.darkMode ? 'Enabled' : 'Disabled'}</span>
                </div>
            </div>
        `;

        // Close button
        const closeBtn = document.createElement('button');
        closeBtn.className = 'btn';
        closeBtn.textContent = 'Close';

        // Assemble the panel
        panel.appendChild(avatar);
        panel.appendChild(details);
        panel.appendChild(closeBtn);
        overlay.appendChild(panel);

        // Add to body
        document.body.appendChild(overlay);

        // Add event listener to close
        closeBtn.addEventListener('click', () => {
            document.body.removeChild(overlay);
        });
    }
    
    function getUserAdminLevel(username) {
        const ADMIN_PERMISSIONS = {
            'Santa': 3,
            'Dr_Mo_Psycho': 2,
            'WaterMelone': 2,
            'Waktool': 1
        };
        return ADMIN_PERMISSIONS[username] || 1;
    }
    
    function showSuggestionsManagementPanel() {
        // Get suggestions
        const staffSuggestions = JSON.parse(localStorage.getItem('staffSuggestions') || '[]');

        // Create panel
        const overlay = document.createElement('div');
        overlay.className = 'admin-panel-overlay';

        const panel = document.createElement('div');
        panel.className = 'admin-panel-container wider';

        // Create header
        const header = document.createElement('div');
        header.className = 'admin-panel-header';
        header.innerHTML = `
            <h2><i class="fas fa-tasks"></i> Suggestions Management</h2>
            <span>${staffSuggestions.length} suggestions in system</span>
        `;

        // Create suggestions list
        const suggestionsList = document.createElement('div');
        suggestionsList.className = 'admin-suggestions-list';

        if (staffSuggestions.length === 0) {
            suggestionsList.innerHTML = '<p class="no-data">No suggestions found</p>';
        } else {
            // Sort suggestions by vote count (highest first)
            staffSuggestions.sort((a, b) => b.votes - a.votes);

            // Create table
            const table = document.createElement('table');
            table.className = 'admin-suggestions-table';

            // Table header
            const thead = document.createElement('thead');
            thead.innerHTML = `
                <tr>
                    <th>Author</th>
                    <th>Suggestion</th>
                    <th>Date</th>
                    <th>Votes</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            `;

            // Table body
            const tbody = document.createElement('tbody');

            staffSuggestions.forEach((suggestion, index) => {
                const tr = document.createElement('tr');

                // Format date
                const date = new Date(suggestion.date);
                const formattedDate = date.toLocaleDateString();

                // Set row class based on status
                tr.className = suggestion.status;

                // Create status dropdown options
                const statusOptions = ['pending', 'approved', 'rejected']
                    .map(status => `<option value="${status}" ${suggestion.status === status ? 'selected' : ''}>${
                        status.charAt(0).toUpperCase() + status.slice(1)
                    }</option>`)
                    .join('');

                tr.innerHTML = `
                    <td>${suggestion.author}</td>
                    <td class="suggestion-text">${suggestion.text}</td>
                    <td>${formattedDate}</td>
                    <td>${suggestion.votes}</td>
                    <td>
                        <select class="status-select" data-index="${index}">
                            ${statusOptions}
                        </select>
                    </td>
                    <td class="actions">
                        <button class="btn-sm delete-suggestion" data-index="${index}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;

                tbody.appendChild(tr);
            });

            table.appendChild(thead);
            table.appendChild(tbody);
            suggestionsList.appendChild(table);
        }

        // Close button
        const closeBtn = document.createElement('button');
        closeBtn.className = 'btn';
        closeBtn.textContent = 'Close';

        // Build panel
        panel.appendChild(header);
        panel.appendChild(suggestionsList);
        panel.appendChild(closeBtn);
        overlay.appendChild(panel);

        // Add to DOM
        document.body.appendChild(overlay);

        // Add event listeners
        closeBtn.addEventListener('click', () => {
            document.body.removeChild(overlay);
        });

        // Status select change events
        document.querySelectorAll('.status-select').forEach(select => {
            select.addEventListener('change', function() {
                const index = parseInt(this.getAttribute('data-index'));
                const newStatus = this.value;

                // Update status
                staffSuggestions[index].status = newStatus;
                staffSuggestions[index].reviewedBy = sessionStorage.getItem('loggedInUser');
                staffSuggestions[index].reviewDate = new Date().toISOString();

                // Save changes
                localStorage.setItem('staffSuggestions', JSON.stringify(staffSuggestions));

                // Update row class
                this.closest('tr').className = newStatus;

                showNotification(`Suggestion status updated to "${newStatus}"`, "success");
            });
        });

        // Delete suggestion buttons
        document.querySelectorAll('.delete-suggestion').forEach(btn => {
            btn.addEventListener('click', function() {
                const index = parseInt(this.getAttribute('data-index'));

                if (confirm('Are you sure you want to delete this suggestion?')) {
                    // Remove the suggestion
                    staffSuggestions.splice(index, 1);

                    // Save changes
                    localStorage.setItem('staffSuggestions', JSON.stringify(staffSuggestions));

                    // Refresh panel
                    document.body.removeChild(overlay);
                    showSuggestionsManagementPanel();

                    showNotification('Suggestion deleted successfully', 'success');
                }
            });
        });
    }
    
    function resetAllSiteData() {
        // This is a dangerous action! Only allow for level 3 admins
        if (getAdminLevel() < 3) {
            showNotification('You do not have permission to perform this action', 'error');
            return;
        }

        // Create a backup of critical data
        const backup = {
            timestamp: new Date().toISOString(),
            userData: {},
            suggestions: JSON.parse(localStorage.getItem('staffSuggestions') || '[]'),
            backupCreator: sessionStorage.getItem('loggedInUser')
        };

        // Backup all user preferences
        for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            if (key && key.startsWith('userPrefs_')) {
                backup.userData[key] = JSON.parse(localStorage.getItem(key) || '{}');
            }
        }

        // Store backup in localStorage
        localStorage.setItem('siteBackup_' + new Date().getTime(), JSON.stringify(backup));

        // Clear all localStorage except the backup
        const backupKeys = Object.keys(localStorage).filter(key => key.startsWith('siteBackup_'));
        localStorage.clear();

        // Restore backups
        backupKeys.forEach(key => {
            localStorage.setItem(key, backup);
        });

        // Keep current user logged in
        const currentUser = sessionStorage.getItem('loggedInUser');
        sessionStorage.setItem('staffLoggedIn', 'true');
        localStorage.setItem('staffLoggedIn', 'true');
        sessionStorage.setItem('loggedInUser', currentUser);
        localStorage.setItem('loggedInUser', currentUser);

        showNotification('All site data has been reset. Reloading page...', 'success');

        // Reload page after delay
        setTimeout(() => {
            location.reload();
        }, 2000);
    }
    </script>
</body>

</html>
